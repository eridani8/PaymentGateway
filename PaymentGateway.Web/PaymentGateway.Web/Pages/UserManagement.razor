@page "/UserManagement"
@using PaymentGateway.Shared.DTOs.User
@attribute [Authorize(Roles = "Admin")]
@inject IAdminService AdminService
@inject ILogger<UserManagement> Logger

<DataGrid TItem="UserDto"
          Data="@_users"
          Responsive
          Hoverable
          Loading="@_isLoading"
          ShowPager>
    <DataGridColumn TItem="UserDto" Field="@nameof(UserDto.Id)" Caption="ID" Sortable />
    <DataGridColumn TItem="UserDto" Field="@nameof(UserDto.Username)" Caption="Логин" Sortable />
    <DataGridColumn TItem="UserDto" Caption="Роли">
        <DisplayTemplate>
            @string.Join(", ", context.Roles)
        </DisplayTemplate>
    </DataGridColumn>
</DataGrid>

@code {
    
    private bool _isLoading = true;
    private List<UserDto> _users = [];

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            _users = await AdminService.GetUsers();
        }
        catch (Exception e)
        {
            Logger.LogError(e, e.Message);
        }
        finally
        {
            _isLoading = false;
            StateHasChanged();
        }
    }

}