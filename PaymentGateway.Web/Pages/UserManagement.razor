@page "/UserManagement"
@using PaymentGateway.Shared.DTOs.User
@attribute [Authorize(Roles = "Admin")]
@inject IAdminService AdminService
@inject ILogger<UserManagement> Logger

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4" Style="height: calc(100vh - 97px); padding: 0;">
    <MudPaper Class="pa-4" Elevation="12" Style="height: 100%; display: flex; flex-direction: column;">
        <MudTable Items="@_users" 
                  Loading="@_isLoading" 
                  Hover="true" 
                  Breakpoint="Breakpoint.Sm" 
                  Dense="true"
                  FixedHeader="true"
                  Height="100%"
                  Width="100%">
            <HeaderContent>
                <MudTh>ID</MudTh>
                <MudTh>Логин</MudTh>
                <MudTh>Роль</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="ID">@context.Id</MudTd>
                <MudTd DataLabel="Логин">@context.Username</MudTd>
                <MudTd DataLabel="Роли">@string.Join(", ", context.Roles)</MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager />
            </PagerContent>
        </MudTable>
    </MudPaper>
</MudContainer>

@code {
    private bool _isLoading = true;
    private List<UserDto> _users = [];

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            _users = await AdminService.GetUsers();
        }
        catch (Exception e)
        {
            Logger.LogError(e, e.Message);
        }
        finally
        {
            _isLoading = false;
        }
    }
}