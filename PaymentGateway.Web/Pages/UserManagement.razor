@page "/UserManagement"
@using PaymentGateway.Shared.DTOs.User
@attribute [Authorize(Roles = "Admin")]
@inject IAdminService AdminService
@inject ILogger<UserManagement> Logger

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4" Style="height: calc(100vh - 97px); padding: 0;">
    <MudPaper Class="pa-4" Elevation="12" Style="height: 100%; display: flex; flex-direction: column;">
        <MudDataGrid Items="@_users" 
                    Loading="@_isLoading" 
                    Hover="true" 
                    Bordered="true"
                    FixedHeader="true"
                    Height="100%">
            <Columns>
                <PropertyColumn Property="x => x.Id" Title="ID" />
                <PropertyColumn Property="x => x.Username" Title="Логин" />
                <PropertyColumn Property="x => x.Roles" Title="Роль">
                    <CellTemplate>
                        @string.Join(", ", context.Item.Roles)
                    </CellTemplate>
                </PropertyColumn>
            </Columns>
            <PagerContent>
                <MudDataGridPager />
            </PagerContent>
        </MudDataGrid>
    </MudPaper>
</MudContainer>

@code {
    private bool _isLoading = true;
    private List<UserDto> _users = [];

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _isLoading = true;
            _users = await AdminService.GetUsers();
        }
        catch (Exception e)
        {
            Logger.LogError(e, e.Message);
        }
        finally
        {
            _isLoading = false;
        }
    }
}